# ゆるキャラかるた

ゆるキャラの画像を使った対戦型推理ゲームです。2人のプレイヤーが交互に「読み手」と「当て手」を担当し、ヒントを出したり、カードを推理したりして楽しみます。

## ゲームの概要

このゲームは、ゆるキャラの画像とヒントを使った推理ゲームです。プレイヤーは2人1組となり、以下のように交互にロールを交代しながらプレイします：

### ゲームの流れ

1. **セッション作成・参加**
   - 1人目のプレイヤーがセッションを作成
   - 2人目のプレイヤーが参加
   - 両プレイヤーが準備完了にするとゲーム開始

2. **読み手フェーズ**
   - 自分のターゲット画像が表示される
   - そのキャラクターについて3つのヒントを入力
   - ヒントは相手プレイヤーが正解を推理するための手がかり

3. **当て手フェーズ**
   - 10枚のカードが表示される
   - 相手から送られたヒントを1つずつ見る
   - ヒントごとに候補となるカードをマーキング可能
   - 3つすべてのヒントを確認したら、1枚を選んで回答

4. **結果と次のラウンド**
   - 正解/不正解の結果が表示される
   - 正解した場合はペアで1ポイント獲得
   - 次のラウンドでは読み手と当て手が入れ替わる

5. **ゲーム終了**
   - 設定されたラウンド数が終了すると、最終結果画面が表示される
   - 各ラウンドの詳細な履歴を確認できる

### ゲームのルール

- **2人プレイ専用**: このゲームは2人のプレイヤーが必要です
- **協力ゲーム**: ペアで高得点を目指す協力型ゲームです
- **ヒントは3つ**: 読み手は毎回3つのヒントを提供します
- **順次公開**: 当て手はヒントを1つずつ順番に見ていきます
- **1回の回答**: 最終的に1枚のカードを選んで回答します
- **マーキング機能**: ヒントごとに候補となるカードを記録できます（推理の補助）

## 技術スタック

### バックエンド
- **Node.js** + **Express**: Webサーバー
- **Socket.IO**: リアルタイム通信
- **PostgreSQL**: データベース（オプション、ログ記録用）

### フロントエンド
- **React**: UIフレームワーク
- **Socket.IO Client**: リアルタイム通信

## 起動方法

### 前提条件

- **Node.js** (v14以上推奨)
- **npm** または **yarn**

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd Yuru_karuta
```

### 2. バックエンドのセットアップ

```bash
cd backend
npm install
```

#### 環境変数の設定（オプション）

`backend`ディレクトリに`.env`ファイルを作成して、以下の環境変数を設定できます：

```env
PORT=4000
FRONTEND_ORIGIN=http://localhost:3000
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
PUBLIC_BASE_URL=http://localhost:4000
```

- `PORT`: バックエンドのポート番号（デフォルト: 4000）
- `FRONTEND_ORIGIN`: フロントエンドのURL（複数ある場合はカンマ区切り）
- `DATABASE_URL`: PostgreSQLの接続URL（ログ機能を使う場合のみ）
- `PUBLIC_BASE_URL`: 画像URLのベース（本番環境用）

#### バックエンドの起動

```bash
npm start
```

バックエンドサーバーが `http://localhost:4000` で起動します。

### 3. フロントエンドのセットアップ

新しいターミナルを開いて：

```bash
cd frontend
npm install
```

#### 環境変数の設定（オプション）

`frontend`ディレクトリに`.env`ファイルを作成：

```env
REACT_APP_API_URL=http://localhost:4000
```

#### フロントエンドの起動

```bash
npm start
```

フロントエンドが `http://localhost:3000` で起動し、ブラウザが自動的に開きます。

### 4. ゲームのプレイ

1. 最初のブラウザで「セッションを作る」を選択し、名前を入力
2. 別のブラウザ（またはシークレットウィンドウ）で `http://localhost:3000` を開く
3. 「セッションに入る」を選択し、表示されているセッションに参加
4. 両プレイヤーが「準備OK」ボタンを押すとゲーム開始

## プロジェクト構成

```
Yuru_karuta/
├── backend/
│   ├── server.js              # メインサーバーファイル
│   ├── characterStore.js      # キャラクター名の取得ロジック
│   ├── package.json
│   ├── yuru_gp_data.json      # ゆるキャラデータ
│   └── images/                # ゆるキャラの画像ファイル
│
├── frontend/
│   ├── public/
│   │   ├── index.html
│   │   ├── audio/             # BGMファイル
│   │   └── se/                # 効果音ファイル
│   ├── src/
│   │   ├── App.jsx            # メインアプリケーション
│   │   ├── api.js             # API通信関数
│   │   ├── socket.js          # Socket.IO設定
│   │   ├── components/        # Reactコンポーネント
│   │   │   ├── GameContainer.jsx  # ゲーム全体の状態管理
│   │   │   ├── LobbyView.jsx      # ロビー画面
│   │   │   ├── ReaderView.jsx     # 読み手画面
│   │   │   ├── GuesserView.jsx    # 当て手画面
│   │   │   ├── EndScreen.jsx      # 結果画面
│   │   │   ├── CardGrid.jsx       # カード表示グリッド
│   │   │   ├── ClueInput.jsx      # ヒント入力UI
│   │   │   ├── ScoreBoard.jsx     # スコア表示
│   │   │   ├── PlayerList.jsx     # プレイヤーリスト
│   │   │   ├── BgmPlayer.jsx      # BGMプレイヤー
│   │   │   └── TapSe.jsx          # タップ効果音
│   │   └── lib/
│   │       └── nameResolver.js    # キャラクター名解決
│   └── package.json
│
└── README.md                  # このファイル
```

## 機能

- **リアルタイム通信**: Socket.IOによる即座のゲーム状態同期
- **マーキング機能**: ヒントごとに候補カードを記録して推理をサポート
- **履歴記録**: 各ラウンドの詳細な記録（データベース連携時）
- **BGM・効果音**: ゲーム体験を向上させる音楽と効果音
- **レスポンシブデザイン**: 様々な画面サイズに対応

## トラブルシューティング

### ポートが使用中の場合

別のアプリケーションがポート4000や3000を使用している場合は、`.env`ファイルでポート番号を変更してください。

### 画像が表示されない場合

- `backend/images/`ディレクトリに画像ファイルが配置されているか確認
- 画像ファイル名は8桁の数字（例: `00000001.png`または`00000001.jpg`）である必要があります
- バックエンドサーバーが正常に起動しているか確認

### 接続できない場合

- バックエンドとフロントエンドの両方が起動しているか確認
- `FRONTEND_ORIGIN`と`REACT_APP_API_URL`の設定が正しいか確認
- ブラウザのコンソールにエラーメッセージがないか確認

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 開発者向け情報

### 主要な通信イベント

**Socket.IO イベント:**
- `clues`: ヒントの送信
- `guess`: 回答の送信
- `guessResult`: 回答結果の受信
- `update`: ゲーム状態の更新
- `roundResult`: ラウンド結果
- `gameFinished`: ゲーム終了
- `lobbyUpdate`: ロビー状態の更新
- `gameStart`: ゲーム開始通知

**REST API エンドポイント:**
- `POST /api/session`: セッション作成
- `POST /api/session/:id/join`: セッション参加
- `GET /api/rooms`: ルーム一覧取得
- `GET /api/session/:id/history`: ゲーム履歴取得
- `POST /api/cards`: カード取得
- `POST /api/ready`: 準備完了
- `POST /api/cancelReady`: 準備解除

---

楽しいゲーム体験をお楽しみください！🎮
